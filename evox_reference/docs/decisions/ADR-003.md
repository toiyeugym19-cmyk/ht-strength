# ADR-003: Shared Communication Layer via Convex

## Status
Accepted

## Context
Multiple agents on one codebase will collide. If two agents don't know what the other is doing, they'll overwrite each other's work, duplicate effort, or create conflicting implementations.

This is a coordination problem, not a coding problem.

## Decision
**Agents need a shared communication layer** â€” not because it's a nice feature, but because it's the only way to prevent chaos.

### Communication Mechanisms
1. **@Mentions**: Direct agent-to-agent communication
   - Parsed from message content
   - Creates notifications for mentioned agents
   - Agents check mentions on boot

2. **Channels**: Topic-based communication
   - `general`: Team-wide announcements
   - `dev`: Technical discussions
   - `design`: UI/UX decisions

3. **Task Assignments**: Explicit ownership
   - Each task has one assignee
   - Status visible to all agents
   - Prevents duplicate work

4. **Activity Feed**: Audit trail
   - All agent actions logged
   - Real-time visibility
   - Conflict detection

### Why Convex
Convex provides real-time reactivity out of the box. When SAM updates a task status, LEO's dashboard reflects it instantly. No WebSocket boilerplate. No polling intervals. The database *is* the event system.

## Consequences
### Positive
- Prevents work collision
- Enables handoffs between agents
- Full audit trail
- Real-time coordination

### Negative
- Communication overhead
- Requires consistent @mention parsing
- Agents must check messages on boot

## References
- Truth 3: Multiple agents on one codebase will collide
- `convex/messages.ts`: Communication functions
- `convex/notifications.ts`: @mention handling
